<!DOCTYPE html>
<html>
<head>
    <title>Tes Diagnosa Supabase</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        body { font-family: monospace; padding: 20px; background: #222; color: #fff; }
        .box { border: 1px solid #555; padding: 15px; margin-bottom: 20px; border-radius: 8px; }
        .success { color: #4ade80; font-weight: bold; }
        .fail { color: #f87171; font-weight: bold; }
        h3 { border-bottom: 1px solid #444; padding-bottom: 10px; }
    </style>
</head>
<body>
    <h2>üïµÔ∏è DIAGNOSA KONEKSI</h2>
    <div id="status">Sedang memeriksa...</div>

    <div class="box">
        <h3>1. Cek Database (Tabel 'items')</h3>
        <div id="db-result">Menunggu...</div>
    </div>

    <div class="box">
        <h3>2. Cek Storage (Bucket 'barang-foto')</h3>
        <div id="storage-result">Menunggu...</div>
    </div>

    <script>
        // --- ISI KUNCI ANDA DI SINI ---
        const URL = 'https://etiwybfhsmcwccfavgri.supabase.co'; 
        const KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImV0aXd5YmZoc21jd2NjZmF2Z3JpIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzAxNDg3NDAsImV4cCI6MjA4NTcyNDc0MH0.Wm0Sbx-N7ZNg_pGoPyBmWi7XEqEzpHvXvOrQE2FJmWs'; 
        // ------------------------------

        const supabase = supabase.createClient(URL, KEY);

        async function runTest() {
            // TES 1: DATABASE
            try {
                const { data, error } = await supabase.from('items').select('*').limit(1);
                const dbDiv = document.getElementById('db-result');
                
                if (error) {
                    dbDiv.innerHTML = `<span class="fail">GAGAL:</span> ${error.message}<br><br>
                    <small>Solusi: Cek nama tabel harus 'items' (huruf kecil) & Matikan RLS di Table Editor.</small>`;
                } else {
                    dbDiv.innerHTML = `<span class="success">BERHASIL!</span><br>Koneksi Database OK.`;
                }
            } catch (err) {
                document.getElementById('db-result').innerText = "Error Script: " + err.message;
            }

            // TES 2: STORAGE
            try {
                // Coba upload file teks dummy kecil
                const dummyFile = new File(["tes"], "tes.txt", { type: "text/plain" });
                const fileName = `tes_diagnosa_${Date.now()}.txt`;

                const { data, error } = await supabase.storage.from('barang-foto').upload(fileName, dummyFile);
                const stDiv = document.getElementById('storage-result');

                if (error) {
                    stDiv.innerHTML = `<span class="fail">GAGAL:</span> ${error.message}<br><br>
                    <small>Solusi: Masuk menu Storage > Policies > Buat Policy baru centang INSERT & SELECT.</small>`;
                } else {
                    stDiv.innerHTML = `<span class="success">BERHASIL!</span><br>Koneksi Storage OK.`;
                }
            } catch (err) {
                document.getElementById('storage-result').innerText = "Error Script: " + err.message;
            }

            document.getElementById('status').innerText = "Pemeriksaan Selesai.";
        }

        runTest();
    </script>
</body>
</html>
